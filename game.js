import{Icon as e}from"./digit.js";export const CELL_SIZE=80;export const CHUNK_SIZE=20;export let cells={};export let generatedChunks=new Set;export function getChunkCoords(e,t){const o=[],n=20*e,r=20*t;for(let e=0;e<20;e++)for(let t=0;t<20;t++)o.push({x:n+e,y:r+t});return o}export function generateChunk(t,o){const n=`${t}_${o}`;if(generatedChunks.has(n))return;generatedChunks.add(n);const r=getChunkCoords(t,o);for(let t of r){const o=`${t.x}_${t.y}`,n=Math.random();let r;if(n<.005)r="key";else if(n<.01)r="clock";else{const e=["mask","letterS","cd","xicon","ethicon","btcicon","eye","lock","scroll","dna","flask"];r=e[Math.floor(Math.random()*e.length)]}cells[o]=new e(t.x,t.y,r,performance.now())}}export function ensureVisibleChunks(e,t,o,n){const r=-e/80,l=-t/80,c=(o-e)/80,s=(n-t)/80,f=Math.floor(r/20)-1,a=Math.floor(c/20)+1,h=Math.floor(l/20)-1,i=Math.floor(s/20)+1;for(let e=f;e<=a;e++)for(let t=h;t<=i;t++)generateChunk(e,t)}export function drawCells(e,t,o,n,r,l){const c=Math.floor(-t/80)-1,s=Math.ceil((n-t)/80)+1,f=Math.floor(-o/80)-1,a=Math.ceil((r-o)/80)+1;for(let n=c;n<=s;n++)for(let r=f;r<=a;r++){const c=`${n}_${r}`,s=cells[c];if(s)if(s.removeStart){const n=1-(l-s.removeStart)/500;if(n<=0){delete cells[c];continue}s.draw(e,t,o,l,n)}else s.draw(e,t,o,l,1)}}export function getClickedIcon(e,t,o,n){const r=performance.now();let l=null,c=1/0;for(const s of Object.keys(cells)){const f=cells[s].screenPosition(o,n,r),a=e-f.x,h=t-f.y,i=Math.hypot(a,h);i<32&&i<c&&(c=i,l=s)}return l}